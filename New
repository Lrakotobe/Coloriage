import com.amazonaws.auth.profile.ProfileCredentialsProvider;
import com.amazonaws.regions.Regions;
import com.amazonaws.services.s3.AmazonS3;
import com.amazonaws.services.s3.AmazonS3ClientBuilder;
import com.amazonaws.services.s3.model.ListObjectsV2Request;
import com.amazonaws.services.s3.model.ListObjectsV2Result;
import com.amazonaws.services.s3.model.S3ObjectSummary;

public class RenameS3Object {

    public static void main(String[] args) {
        String bucketName = "votre-bucket";
        String directory = "chemin/nom/";
        String newKey = "chemin/nom.csv";

        // Configurer le client S3
        AmazonS3 s3Client = AmazonS3ClientBuilder.standard()
                .withRegion(Regions.US_WEST_2)  // Remplacez par votre région
                .withCredentials(new ProfileCredentialsProvider())
                .build();

        // Lister les objets dans le répertoire
        ListObjectsV2Request listObjectsRequest = new ListObjectsV2Request()
                .withBucketName(bucketName)
                .withPrefix(directory);
        
        ListObjectsV2Result result = s3Client.listObjectsV2(listObjectsRequest);
        
        for (S3ObjectSummary objectSummary : result.getObjectSummaries()) {
            String oldKey = objectSummary.getKey();
            
            // Vérifiez que l'objet est bien le fichier que vous souhaitez renommer
            if (oldKey.startsWith(directory) && oldKey.endsWith(".csv")) {
                // Copier l'objet vers le nouveau nom
                s3Client.copyObject(bucketName, oldKey, bucketName, newKey);
                System.out.println("Copie réussie: " + oldKey + " vers " + newKey);

                // Supprimer l'ancien objet
                s3Client.deleteObject(bucketName, oldKey);
                System.out.println("Suppression réussie: " + oldKey);
                
                // Si un seul fichier doit être renommé, on peut sortir de la boucle après le renommage
                break;
            }
        }
    }
}
